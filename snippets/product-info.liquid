{% comment %}
  Product Info Snippet

  Usage:
    {% render 'product-info', product: product %}

  Parameters:
    - product: The product object
    - show_vendor: Show vendor/brand (default: true)
    - show_quantity: Show quantity selector (default: true)
{% endcomment %}

{%- assign show_vendor = show_vendor | default: true -%}
{%- assign show_quantity = show_quantity | default: true -%}
{%- assign current_variant = product.selected_or_first_available_variant -%}

<div class="product-info" data-product-info>
  <div class="product-info__inner">
    {% comment %} Product Title {% endcomment %}
    <h1 class="product-info__title">{{ product.title }}</h1>

    {% comment %} Subtitle / Vendor {% endcomment %}
    {%- if show_vendor -%}
      {%- if product.metafields.custom.subtitle != blank -%}
        <p class="product-info__subtitle">{{ product.metafields.custom.subtitle }}</p>
      {%- elsif product.vendor != blank -%}
        <p class="product-info__subtitle">{{ product.vendor }}</p>
      {%- endif -%}
    {%- endif -%}

    {% comment %} Price {% endcomment %}
    <div class="product-info__price">
      {%- if current_variant.compare_at_price > current_variant.price -%}
        <span class="product-info__price-compare">{{ current_variant.compare_at_price | money }}</span>
        <span class="product-info__price-sale">{{ current_variant.price | money }}</span>
      {%- else -%}
        <span class="product-info__price-regular">{{ current_variant.price | money }}</span>
      {%- endif -%}
      <span class="product-info__price-tax">{{ 'products.product.include_taxes' | t }}</span>
    </div>

    {% comment %} Availability {% endcomment %}
    <div class="product-info__availability">
      {%- if current_variant.available -%}
        <span class="product-info__availability-dot product-info__availability-dot--in-stock"></span>
        <span class="product-info__availability-text">{{ 'products.product.in_stock' | t }}</span>
      {%- else -%}
        <span class="product-info__availability-dot product-info__availability-dot--out-of-stock"></span>
        <span class="product-info__availability-text">{{ 'products.product.sold_out' | t }}</span>
      {%- endif -%}
    </div>

    {% comment %} Variant Selector {% endcomment %}
    {%- if product.has_only_default_variant == false -%}
      <div class="product-info__variants">
        {%- for option in product.options_with_values -%}
          <div class="product-info__variant-group">
            <label class="product-info__variant-label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
              {{ option.name }}
            </label>
            <select
              id="Option-{{ section.id }}-{{ forloop.index0 }}"
              class="product-info__variant-select"
              data-option-index="{{ forloop.index0 }}"
            >
              {%- for value in option.values -%}
                <option value="{{ value | escape }}" {% if option.selected_value == value %}selected{% endif %}>
                  {{ value }}
                </option>
              {%- endfor -%}
            </select>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}

    {% comment %} Add to Cart Form {% endcomment %}
    {%- form 'product', product, id: 'product-form', data-product-form: '', class: 'product-info__form' -%}
      <input type="hidden" name="id" value="{{ current_variant.id }}" data-variant-id>

      {%- if show_quantity -%}
        <div class="product-info__quantity">
          <label class="product-info__quantity-label" for="Quantity-{{ section.id }}">
            {{ 'products.product.quantity.label' | t }}
          </label>
          <div class="product-info__quantity-selector">
            <button type="button" class="product-info__quantity-btn" data-quantity-minus aria-label="{{ 'products.product.quantity.decrease' | t }}">-</button>
            <input
              type="number"
              id="Quantity-{{ section.id }}"
              name="quantity"
              class="product-info__quantity-input"
              value="1"
              min="1"
              data-quantity-input
            >
            <button type="button" class="product-info__quantity-btn" data-quantity-plus aria-label="{{ 'products.product.quantity.increase' | t }}">+</button>
          </div>
        </div>
      {%- endif -%}

      <button
        type="submit"
        class="product-info__add-to-cart btn btn--primary"
        data-add-to-cart
        {% unless current_variant.available %}disabled{% endunless %}
      >
        <span data-add-to-cart-text>
          {%- if current_variant.available -%}
            {{ 'products.product.add_to_cart' | t }}
          {%- else -%}
            {{ 'products.product.sold_out' | t }}
          {%- endif -%}
        </span>
        <span class="product-info__add-to-cart-loading" aria-hidden="true">
          <svg class="spinner" viewBox="0 0 24 24" width="20" height="20">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="60" stroke-dashoffset="20"/>
          </svg>
        </span>
      </button>
    {%- endform -%}

    {% comment %} Product Description {% endcomment %}
    {%- if product.description != blank -%}
      <div class="product-info__description">
        <details class="product-info__accordion">
          <summary class="product-info__accordion-header">
            <span>{{ 'products.product.description' | t }}</span>
            <svg class="product-info__accordion-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </summary>
          <div class="product-info__accordion-content">
            {{ product.description }}
          </div>
        </details>
      </div>
    {%- endif -%}
  </div>
</div>
